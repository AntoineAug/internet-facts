$(document).ready(function(){$('.hide_bomb').fadeOut(6000);$("#content, #footer, #social-networks").stop().animate({"opacity":"1"},2000);$(".fade_jquery").hover(function(){$(this).stop().animate({"opacity":"1"},"slow")},function(){$(this).stop().animate({"opacity":"0.5"},"slow")});$('.error,.success').css('margin-left','-1000px');$('.error,.success').animate({marginLeft:'+=1000px',},2000,function(){})});$(".hide_this").click(function(){$(this).slideUp(2000)});$(function(){$('.slidedown').slideDown(1500)});function hide_intro(){$('#intro').slideUp(2000);$.ajax({type:'POST',url:'/ajax/hide_intro.php'});return false};

$(document).ready(function(){
	$("#submit_fact_admin").submit( function(){
		$('#notification').html('');
		$('#notification').html('<div class="error">Loading..</div>').slideDown();
		var textarea_text_fact = $('#textarea_text_fact').val();

		$.post("/ajax/add_fact.php", { text_fact: textarea_text_fact, admin: true },
			function(data)
			{
				if(data == 1)
				{
					var div_response = '<div class="success">Your Fact has been added successfully!</div>';
				}
				else
				{
					var div_response = '<div class="error">Your Fact could not be added.</div>';
				}

				$('#notification').html(div_response).delay(3000).slideUp();
				$('#textarea_text_fact').val('');
				$('#textarea_text_fact').focus();
			});
		return false;
			});
		
});

function validateEmail(email) {
    var emailReg = /^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/;
    if(!emailReg.test(email)) {
        return false;
    } else {
        return true;
    }
}

function validateUsername(username) {
    var usernameReg = /^([\w]{4,})?$/;
    if(!usernameReg.test(username)) {
        return false;
    } else {
        return true;
    }
}

function moderate_fact(approve,id_fact) {
	$(".footer_fact[data-id="+id_fact+"]").html("<em>Wait...</em>");
	$.ajax({
		type: 'post',
		url: 'http://internet-facts.com/ajax/moderate_facts.php',
		data: {
			id_fact: id_fact,
			approve: approve
		},
		success: function(data) {
			var nb_facts_moderation = $("#nb_facts_moderation").html();
			var txt_fact = $("#txt_fact").html();

			if (nb_facts_moderation-1 <= 1 && txt_fact == 'Facts')
			{
				$("#txt_fact").html('Fact');
			}
			$("#nb_facts_moderation").html(nb_facts_moderation-1);

			$(".footer_fact[data-id="+id_fact+"]").html(data);
			$(".post[data-id="+id_fact+"]").delay(1000).slideUp(500);
		}
	});
	
	return false;
}


$(document).ready(function(){
	$("#submit_fact_user").submit( function(){
		$('#notification').html('');
		$('#notification').html('<div class="error">Loading..</div>').slideDown();
		var username_form = $('#username').val().toLowerCase();
		var email_form = $('#email').val();
		var text_fact_form = $('#textarea_text_fact').val();

		if (validateUsername(username_form) == false || username_form.length === 0)
		{
			$('#notification').html('<div class="error">Please enter a valid username.</div>').delay(3000).slideUp();
			$('#username').val('').focus();
		}
		else 
		{
			if (validateEmail(email_form) == false || email_form.length === 0)
			{
				$('#notification').html('<div class="error">Please enter a valid email address.</div>').delay(3000).slideUp();
				$('#email').val('').focus();
			}
			else
			{
				if (text_fact_form.length < 50)
				{
					var target = 50 - text_fact_form.length;
					var characters = 'characters';

					if (target == 1)
					{
						characters = 'character';
					}
					$('#notification').html('<div class="error">Your Fact is too short! It should be at least 50 characters ('+target+' '+characters+' left).</div>').delay(3000).slideUp();
					$('#textarea_text_fact').focus();
				}
				else
				{
					$.post("/ajax/add_fact.php", { text_fact: text_fact_form, username: username_form, email: email_form, is_visitor: true},
					function(data)
					{
						if(data == 1)
						{
							var div_response = '<div class="success">Your Fact has been added successfully!</div>';
							$('#textarea_text_fact').val('').focus();
						}
						else if (data == 0)
						{
							var div_response = '<div class="error">The form is not filled correctly.</div>';
						}
						else if (data == 2)
						{
							var div_response = '<div class="error">This email is not associated with the current username.</div>';
							$('#email').val('').focus();
						}
						else if (data == 3)
						{
							var div_response = '<div class="error">You\'ve added too much Facts for today! Come back tomorrow.</div>';
						}

						$('#notification').html(div_response).delay(3000).slideUp();
					});
				}

			}
		}
		return false;
			});
		
});